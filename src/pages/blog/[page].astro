---
import Pagination from '@/components/ui/Pagination.astro'
import Layout from '@/layouts/Layout.astro'
import { trimExcerpt } from '@/lib/utils'
import { template } from '@/settings'
import { getCollection } from 'astro:content'

export async function getStaticPaths({ paginate }): Promise<Astro.getStaticPathsResult> {
    const blogEntries = await getCollection("blog");

    const posts = blogEntries
        .map(post => ({
            title: post.data.title,
            date: post.data.date,
            badge: post.data.tags[0],
            excerpt: trimExcerpt(post.data.excerpt),
            slug: `${template.base}/blog/${post.id}`,
        }))
        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

    // Always return at least one page so the route exists
    if (posts.length === 0) {
        return paginate([], { pageSize: template.postPerPage });
    }

    return paginate(posts, {
        pageSize: template.postPerPage,
    });
}
const { page } = Astro.props
const hasPosts = page.data.length > 0
---

<Layout title='Blog'>
  <div>
    <h1 class='text-3xl font-bold mb-8'>Blog</h1>

    {hasPosts ? (
      <!-- Blog Posts -->
      <div class='grid gap-8'>
        {
          page.data.map(post => (
            <article class='card bg-base-200 transition-all'>
              <div class='card-body'>
                <div class='flex justify-between items-start'>
                  <h2 class='card-title text-xl'>
                    <a href={post.slug} class='hover:text-accent'>
                      {post.title}
                    </a>
                  </h2>
                  <div class='badge badge-accent badge-outline p-4'>
                    {post.badge}
                  </div>
                </div>
                <time datetime={post.date} class='text-sm text-base-content/71'>
                  {new Date(post.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })}
                </time>
                <p class='mt-4'>{post.excerpt}</p>
                <div class='card-actions justify-end'>
                  <a
                    href={post.slug}
                    class='btn btn-sm btn-secondary text-secondary-content'
                  >
                    Read More
                  </a>
                </div>
              </div>
            </article>
          ))
        }
      </div>

      <div class='flex justify-center mt-8'>
        <Pagination page={page} />
      </div>
    ) : (
      <!-- Coming Soon State -->
      <div class='flex flex-col items-center justify-center py-20 text-center'>
        <div class='bg-base-200 rounded-full p-6 mb-6'>
          <svg class='w-12 h-12 text-secondary' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'>
            <path d='M12 20h9'/><path d='M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z'/>
          </svg>
        </div>
        <h2 class='text-2xl font-bold mb-3'>Coming Soon</h2>
        <p class='text-base-content/60 max-w-md leading-relaxed'>
          I'm working on posts about computational biophysics, molecular dynamics, and research tips. Stay tuned for updates!
        </p>
        <div class='mt-8 flex flex-wrap gap-2 justify-center'>
          <span class='badge badge-outline badge-secondary p-3'>Molecular Dynamics</span>
          <span class='badge badge-outline badge-secondary p-3'>Enhanced Sampling</span>
          <span class='badge badge-outline badge-secondary p-3'>Machine Learning</span>
          <span class='badge badge-outline badge-secondary p-3'>Research Tips</span>
        </div>
      </div>
    )}
  </div>
</Layout>

---
import { Image } from 'astro:assets'
import { profile } from '../../settings'
import SocialIcons from './SocialIcons.astro'
import ProfilePictures from '@/assets/profile.jpeg'
import { getCollection } from 'astro:content'
import { template } from '@/settings'

const isBlogPopulated = await getCollection('blog').then(collection => collection.length > 0)

const { fullName, title, institute } = profile

const navItems = [
  { href: `${template.base}/`, label: 'Home', match: '/' },
  { href: `${template.base}/my-journey`, label: 'My Journey', match: '/my-journey' },
  { href: `${template.base}/research`, label: 'Research', match: '/research' },
  { href: `${template.base}/papers`, label: 'Publications', match: '/papers' },
]
---
<aside
  class='px-4 pt-4 h-screen w-[20rem] bg-base-200 text-base-content flex flex-col'
>
  <div class='flex flex-col my-8 justify-between h-full'>
    <div>
      <!-- Profile Section -->
      <div class='flex justify-center items-center flex-col'>
        <a href={`${template.base}/`} class='transition-opacity hover:opacity-80'>
          <Image
            class='mask mask-circle size-36'
            src={ProfilePictures}
            alt={`Profile picture of ${fullName}`}
          />
        </a>
        <div class='text-center mt-5 hidden lg:block'>
          <a href={`${template.base}/`} class='hover:text-secondary transition-colors duration-200'>
            <h1 class='text-xl font-black leading-tight'>{fullName}</h1>
          </a>
          <p class='text-sm text-base-content/70 mt-1 font-medium'>{title}</p>
          <p class='text-xs text-base-content/50 mt-0.5'>{institute}</p>
        </div>
      </div>

      <!-- Divider -->
      <div class='mx-6 mt-8 mb-2'>
        <hr class='border-base-300' />
      </div>

      <!-- Navigation -->
      <div class='mx-4 mt-4'>
        <ul class='space-y-1 menu menu-md'>
          {navItems.map((item) => (
            <li>
              <a
                href={item.href}
                data-match={item.match}
                class='nav-link text-base font-medium rounded-lg transition-all duration-200'
              >
                {item.label}
              </a>
            </li>
          ))}
          <li>
            <a
              href={`${template.base}/blog/1`}
              data-match='/blog'
              class='nav-link text-base font-medium rounded-lg transition-all duration-200'
            >
              Blog
            </a>
          </li>
          <li>
            <a
              href={`${template.base}/contact`}
              data-match='/contact'
              class='nav-link text-base font-medium rounded-lg transition-all duration-200'
            >
              Contact
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Social Icons -->
    <div class='mx-4'>
      <div class='mx-6 mb-4'>
        <hr class='border-base-300' />
      </div>
      <SocialIcons />
    </div>
  </div>
</aside>

<style is:global>
  .nav-link:not(.nav-active):hover {
    background-color: oklch(var(--bc) / 0.1);
  }
  .nav-link.nav-active {
    background-color: oklch(var(--s) / 0.15);
    color: oklch(var(--s));
    font-weight: 600;
    border-left: 3px solid oklch(var(--s));
  }
</style>

<script is:inline>
  function updateActiveNav() {
    var path = window.location.pathname.replace(/\/$/, '') || '/';
    var links = document.querySelectorAll('.nav-link');

    for (var i = 0; i < links.length; i++) {
      var link = links[i];
      var match = link.getAttribute('data-match');
      if (!match) continue;

      var isActive = path === match || (match !== '/' && path.startsWith(match));

      if (isActive) {
        link.classList.add('nav-active');
      } else {
        link.classList.remove('nav-active');
      }
    }
  }

  document.addEventListener('astro:page-load', updateActiveNav);
  document.addEventListener('astro:after-swap', updateActiveNav);
  updateActiveNav();
</script>
